<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog WebApp</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <nav>        
        <div class="container nav_container">
            <a href="index.html" class="nav_logo">BlogMedia</a>
            <ul class="nav_items">
                <li class="active_navlink"><a href="index.html">Home</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="category-posts.html?category=Artificial Intelligence">Categories</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="signin.html">Sign In</a></li>
                <li class="nav_profile" style="display: none;">
                    <div class="avatar_container">
                        <div class="avatar">
                            <img src="./images/avatar1.jpg" alt="User Avatar">
                        </div>
                    </div>
                    <div class="username_cnt">
                        <span></span>
                    </div>
                    <ul class="nav_profile_popup">
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="logout.html">Log Out</a></li>
                    </ul>
                </li>
            </ul>
            <button id="open_nav-btn"><i class="uil uil-bars"></i></button>
            <button id="close_nav-btn"><i class="uil uil-multiply"></i></button>
        </div>
    </nav>


    <section class="featured" id="featured-posts" >        
        <!-- Dynamically featured posts will be shown here              -->
    </div>
    </section>

    <section class="posts" id="normal-posts" >
      <div class="container posts_container" id="normal-posts">
          <!-- Dynamically posts will be shown here              -->
      </div>
      <div class="container flex-center">
        <button class="btn sm" style="font-size: 0.9rem;">See more</button>
      </div>
    </section>




    <section class="featured skeleton" id="featured-skeleton">
      <div class="container featured_container" style="opacity: 1;">
          <div class="post_thumbnail skeleton-box"></div>
          <div class="post_info">
              <div class="skeleton-box category_button"></div>
              <div id="post-meta" class="skeleton-box">
                  <div class="skeleton-box" style="width: 100px; height: 20px;"></div>
                  <div class="skeleton-box" style="width: 100px; height: 20px;"></div>
                  <div class="skeleton-box" style="width: 100px; height: 20px;"></div>
              </div>
              <h2 class="skeleton-box" style="height: 30px; width: 70%;"></h2>
              <p class="skeleton-box" style="height: 80px; width: 90%;"></p>
              <div class="post_author">
                  <div class="post_author-avatar skeleton-box"></div>
                  <div class="post_author-info">
                      <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
                      <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
                  </div>
              </div>
          </div>
      </div>
  </section>
  
  <section class="posts skeleton" id="posts-skeleton">
      <div class="container posts_container">
          <!-- Repeat Skeleton Articles -->
          <article class="post">
              <div class="post_thumbnail skeleton-box"></div>
              <div id="post-meta" style="background-color: aliceblue;">
                  <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                  <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                  <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
              </div>
              <div class="post_info">
                  <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
                  <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
                  <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
                  <div class="post_author">
                      <div class="post_author-avatar skeleton-box"></div>
                      <div class="post_author-info">
                          <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
                          <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
                      </div>
                  </div>
              </div>
          </article>
          <!-- Add more skeleton articles as needed -->
      </div>
  </section>
  


    




    <section class="category_buttons">
        <div class="container category_buttons-container">
          <a href="category-posts.html?category=Artificial Intelligence" class="category_button">Artificial Intelligence</a>
          <a href="category-posts.html?category=Renewable Energy" class="category_button">Renewable Energy</a>
          <a href="category-posts.html?category=Electric Vehicles" class="category_button">Electric Vehicles</a>
          <a href="category-posts.html?category=Stock Market" class="category_button">Stock Market</a>
          <a href="category-posts.html?category=Recycling E-waste" class="category_button">Recycling E-waste</a>
          <a href="category-posts.html?category=Sports" class="category_button">Sports</a>
        </div>
    </section>



    <footer>
        <div class="footer_socials">
            <a href="https://youtube.com"><li class="uil uil-youtube"></li></a>
            <a href="https://facebook.com"><li class="uil uil-facebook-f"></li></a>
            <a href="https://instagram.com"><li class="uil uil-instagram-alt"></li></a>
            <a href="https://linkedin.com"><li class="uil uil-linkedin"></li></a>
            <a href="https://tiwtter.com"><li class="uil uil-twitter"></li></a>
        </div>
        <div class="container footer_container">
            <article>
                <h4>Categories</h4>
                <ul>
                    <li><a href="category-posts.html?category=Artificial Intelligence">Artificial Intelligence</a></li>
                    <li><a href="category-posts.html?category=Stock Market">Stock Market</a></li>
                    <li><a href="category-posts.html?category=Renewable Energy">Renewable Energy</a></li>
                    <li><a href="category-posts.html?category=Electric Vehicles">Electric Vehicles</a></li>
                    <li><a href="category-posts.html?category=Recycling E-waste">Recycling E-waste</a></li>
                    <li><a href="category-posts.html?category=Sports">Sports</a></li>
                </ul>
            </article>
            <article>
                <h4>Support</h4>
                <ul>
                    <li><a href="contact.html">Call Numbers</a></li>
                    <li><a href="contact.html">Emails</a></li>
                </ul>
            </article>
            <article>
                <h4>Blog</h4>
                <ul>
                    <li><a href="popular.html">Popular</a></li>
                    <li><a href="category-posts.html?category=Artificial Intelligence">Categories</a></li>
                </ul>
            </article>
            <article>
                <h4>Permalinks</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="contact.html">Contacts</a></li>
                </ul>
            </article>
        </div>
        <div class="footer_copyright">
            <small>Copyright &copy; 2024 BlogMedia</small>
        </div>
    </footer>
    





<!-- <script src="./main.js"></script> -->
<script src="./nav.js"></script>

<script>

const postsContainer = document.querySelector(".posts_container");
const featuredDiv = document.querySelector(".featured"); 
const postsSection = document.querySelector(".posts");
const featuredPosts = [];
let normalPosts = [];

addSkeletonArticles(3);

// Function to fetch posts
async function fetchPosts() {
  const featuredSkeleton = document.getElementById("featured-skeleton");
  const postsSkeleton = document.getElementById("posts-skeleton");
  postsSection.style.display = "none";
  featuredDiv.style.display = "none";


  try {
    const response = await fetch("https://blog-website-beta-wine.vercel.app/get-publicPosts");
    if (!response.ok) throw new Error("Failed to fetch posts");

    const posts = await response.json();    
    localStorage.setItem("posts", JSON.stringify(posts));

     // Hide skeleton loaders
    featuredSkeleton.style.display = "none";
    postsSkeleton.style.display = "none";
    // Show real content sections
    postsSection.style.display = "block";
    featuredDiv.style.display = "block";
 
    filterPosts(posts);
    // displayPosts(posts);
    initalPostsLoad();
    displayFeaturedPosts(featuredPosts);

  } catch (error) {
    console.error("Error fetching posts:", error);
    postsContainer.innerHTML = `<p>Failed to load posts. Please try again later.</p>`;
  }
}


function filterPosts(posts) {
  posts.forEach((post) => {
      if (post.isFeatured) {
        featuredPosts.push(post);
      } else {
        normalPosts.push(post);
      }
  });
}


const seeMoreButton = document.querySelector(".btn.sm");
// let globalPosts = []; // To store fetched posts
let currentIndex = 0; // Track the current position in the posts array
const postsPerPage = 9; // Number of posts to display initially or on each click


// Function to load more posts
function loadMorePosts(isLoadTillCurrentIndex=false) {
    //ensure the argument is a boolean and not an event object
    if (typeof isLoadTillCurrentIndex !== "boolean") {
        isLoadTillCurrentIndex = false; // Handle unexpected event object
    }
    const remainingPosts = normalPosts.slice(currentIndex, currentIndex + postsPerPage);
    displayPosts(remainingPosts);
    if(!isLoadTillCurrentIndex) currentIndex += postsPerPage;

    // Hide "See More" button if all posts are loaded
    if (currentIndex >= normalPosts.length) {
        seeMoreButton.style.display = "none";
    }
}

// Event listener for "See More" button
seeMoreButton.addEventListener("click", loadMorePosts);

// Initial setup on DOMContentLoaded
function initalPostsLoad() {
    // globalPosts = getPostsFromLocalStorage();
  if (normalPosts.length > 0) {
    loadMorePosts(); // Display the initial set of posts
  } else {
    postsContainer.innerHTML = `<p>No posts available.</p>`;
    seeMoreButton.style.display = "none"; // Hide button if no posts
  }
}


// Transition Effect display featured posts
function displayFeaturedPosts(posts) {
  let currentIndex = 0;

    updatePost(posts, currentIndex);
    setTimeout(() => {
        document.querySelector(".featured_container").classList.add("active");
    }, 1);
  setInterval(() => {    
        currentIndex = (currentIndex + 1) % posts.length;  // Circular flow
        updatePost(posts, currentIndex);
        setTimeout(() => {
            document.querySelector(".featured_container").classList.add("active");
        }, 1);
        setTimeout(() => {
            document.querySelector(".featured_container").classList.remove("active");
        }, 3000);
  }, 4000);  // Change every 4 seconds
}
  

// Function to update/change featured post
function updatePost(posts, index) {
  const post = posts[index];
  featuredDiv.innerHTML = `
  <div class="container featured_container" id="featured-posts">
    <div class="post_thumbnail">
      <a href="post.html?id=${post.id}">
      <img src="${post.thumbnailURL || './images/blog27.jpg'}" alt="Post Thumbnail">
      </a>
    </div>
    <div class="post_info">
      <a href="category-posts.html?category=${encodeURIComponent(post.category)}" class="category_button">
        ${post.category}
      </a>
      <div id="post-meta">
            <div id="view-count"><i class="fa-solid fa-eye"></i><span id="views">${post.views}</span></div>
            <div id="like-count"><i class="fa-solid fa-thumbs-up"></i><span id="likes">${post.likes}</span></div>
            <div id="comment-count"><i class="fa-solid fa-comment-dots"></i><span id="comments">${post.commentsCount}</span></div>
      </div>
      <h3 class="post_title">
        <a href="post.html?id=${post.id}">${post.title}</a>
      </h3>
      <p class="post_body">
        ${post.content.substring(0, 300)}... <!-- Truncate content for preview -->
      </p>
      <div class="post_author">
        <div class="post_author-avatar">
          <img src="${post.authorAvatar || './images/default-avatar.jpg'}" alt="Author Avatar">
        </div>
        <div class="post_author-info">
          <h5>By: ${post.authorName || "Unknown Author"}</h5>
          <small>${formatDate(post.created_at)}</small>
        </div>
      </div>
    </div>
   </div>
  `;
}


// Function to display posts
function displayPosts(posts) {
//   postsContainer.innerHTML = ""; // Clear existing content

  posts.forEach((post) => {
    const postElement = document.createElement("article");
    postElement.classList.add("post");

    postElement.innerHTML = `
      <div class="post_thumbnail">
        <a href="post.html?id=${post.id}">
        <img src="${post.thumbnailURL || './images/blog27.jpg'}" alt="Post Thumbnail">
        </a>
      </div>
      <div id="post-meta">
            <div id="view-count"><i class="fa-solid fa-eye"></i><span id="views">${post.views}</span></div>
            <div id="like-count"><i class="fa-solid fa-thumbs-up"></i><span id="likes">${post.likes}</span></div>
            <div id="comment-count"><i class="fa-solid fa-comment-dots"></i><span id="comments">${post.commentsCount}</span></div>
        </div>
      <div class="post_info">
        <a href="category-posts.html?category=${encodeURIComponent(post.category)}" class="category_button">
          ${post.category}
        </a>
        <h3 class="post_title">
          <a href="post.html?id=${post.id}">${post.title}</a>
        </h3>
        <p class="post_body">
          ${post.content.substring(0, 300)}... <!-- Truncate content for preview -->
        </p>
        <div class="post_author">
          <div class="post_author-avatar">
            <img src="${post.authorAvatar || './images/default-avatar.jpg'}" alt="Author Avatar">
          </div>
          <div class="post_author-info">
            <h5>By: ${post.authorName || "Unknown Author"}</h5>
            <small>${formatDate(post.created_at)}</small>
          </div>
        </div>
      </div>
    `;

    postsContainer.appendChild(postElement);
  });
}


// Function to format the date (e.g., for display)
function formatDate(dateString) {
  const date = new Date(dateString);
  const options = { year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: 'numeric' };
  return date.toLocaleDateString(undefined, options);
}


function getPostsFromLocalStorage() {
  const posts = localStorage.getItem("posts");
  return posts ? JSON.parse(posts) : [];
}


function addSkeletonArticles(count) {
  const postsSkeleton = document.querySelector("#posts-skeleton .posts_container");
  if (!postsSkeleton) {
    console.error("Skeleton container not found");
    return;
  }

  // Clear existing skeleton articles (optional)
  postsSkeleton.innerHTML = "";
  // Create and append the specified number of skeleton articles
  for (let i = 0; i < count; i++) {
    const skeletonArticle = `
      <article class="post">
        <div class="post_thumbnail skeleton-box"></div>
        <div id="post-meta" class="skeleton-box">
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
        </div>
        <div class="post_info">
          <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
          <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
          <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
          <div class="post_author">
            <div class="post_author-avatar skeleton-box"></div>
            <div class="post_author-info">
              <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
              <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
            </div>
          </div>
        </div>
      </article>
    `;

    postsSkeleton.innerHTML += skeletonArticle;
  }
}



// Fetch posts when the page loads
window.onload = fetchPosts;


</script>

</body>
</html>