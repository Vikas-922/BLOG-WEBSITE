<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog WebApp</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
</head>
<body>
    <nav>        
        <div class="container nav_container">
            <a href="index.html" class="nav_logo">BlogMedia</a>
            <ul class="nav_items">
                <li><a href="index.html">Home</a></li>
                <li class="active_navlink"><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="category-posts.html?category=Artificial Intelligence">Categories</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="signin.html">Sign In</a></li>
                <li class="nav_profile" style="display: none;">
                    <div class="avatar_container">
                        <div class="avatar">
                            <img src="./images/avatar1.jpg" alt="User Avatar">
                        </div>
                    </div>
                    <div class="username_cnt">
                        <span></span>
                    </div>
                    <ul class="nav_profile_popup">
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="logout.html">Log Out</a></li>
                    </ul>
                </li>
            </ul>
            <button id="open_nav-btn"><i class="uil uil-bars"></i></button>
            <button id="close_nav-btn"><i class="uil uil-multiply"></i></button>
        </div>
    </nav>

    <section class="search_bar">
        <form class="container search_bar-container" id="search-form">
          <div>
            <i class="uil uil-search"></i>
            <input type="search" id="search-input" placeholder="Search for posts...">
          </div>
          <button type="submit" class="btn">Go</button>
        </form>
      </section>
    

    <section class="posts">
        <div class="container posts_container">           
            <!-- <article class="post">
                <div class="post_thumbnail">
                    <img src="./images/blog9.jpg">
                </div>

                <div id="post-meta">
                    <div id="view-count"><i class="fa-solid fa-eye"></i><span id="views"> 0</span></div>
                    <div id="like-count"><i class="fa-solid fa-thumbs-up"></i><span id="likes"> 0</span></div>
                    <div id="comment-count"><i class="fa-solid fa-comment-dots"></i><span id="comments"> 0</span></div>
                </div>

                <div class="post_info">
                    <a href="category-posts.html" class="category_button">Recycling E-waste</a>
                    <h3 class="post_title"><a href="post9.html">Recycle Your E-waste</a></h3>
                    <p class="post_body">
                        In our rapidly advancing digital age, e-waste—discarded electronic devices like smartphones, laptops, and batteries—has become one of the fastest-growing waste streams. Recycling e-waste is not just an environmental imperative but a gateway to a circular economy. By properly recycling these gadgets, we recover precious metals and reduce harmful pollutants, transforming what was once electronic clutter into valuable resources. Imagine turning your old phone into a new device or a piece of jewelry; it's like giving technology a second life. Embracing e-waste recycling means we’re not only cleaning up our planet but also making a statement: technology’s lifecycle should be as innovative as the tech itself.
                    </p>
                    <div class="post_author">
                        <div class="post_author-avatar">
                            <img src="./images/avatar10.jpg">
                        </div>
                        <div class="post_author-info">
                            <h5>By: Harsh Patil</h5>
                            <small>September 11, 2024 - 21:07</small>
                        </div>
                    </div>
                </div>
            </article> -->
        </div>
        <div class="container flex-center">
            <button class="btn sm" style="font-size: 0.9rem;">See more</button>
        </div>
    </section>



    <section class="posts skeleton" id="posts-skeleton">
        <div class="container posts_container">
            <!-- Repeat Skeleton Articles -->
            <article class="post">
                <div class="post_thumbnail skeleton-box"></div>
                <div id="post-meta">
                    <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                    <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                    <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                </div>
                <div class="post_info">
                    <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
                    <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
                    <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
                    <div class="post_author">
                        <div class="post_author-avatar skeleton-box"></div>
                        <div class="post_author-info">
                            <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
                            <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
                        </div>
                    </div>
                </div>
            </article>
            <!-- Add more skeleton articles as needed -->
        </div>
    </section>






    <section class="category_buttons">
        <div class="container category_buttons-container">
            <a href="category-posts.html?category=Artificial Intelligence" class="category_button">Artificial Intelligence</a>
            <a href="category-posts.html?category=Renewable Energy" class="category_button">Renewable Energy</a>
            <a href="category-posts.html?category=Electric Vehicles" class="category_button">Electric Vehicles</a>
            <a href="category-posts.html?category=Stock Market" class="category_button">Stock Market</a>
            <a href="category-posts.html?category=Recycling E-waste" class="category_button">Recycling E-waste</a>
            <a href="category-posts.html?category=Sports" class="category_button">Sports</a>
        </div>
    </section>


    <footer>
        <div class="footer_socials">
            <a href="https://youtube.com"><li class="uil uil-youtube"></li></a>
            <a href="https://facebook.com"><li class="uil uil-facebook-f"></li></a>
            <a href="https://instagram.com"><li class="uil uil-instagram-alt"></li></a>
            <a href="https://linkedin.com"><li class="uil uil-linkedin"></li></a>
            <a href="https://tiwtter.com"><li class="uil uil-twitter"></li></a>
        </div>
        <div class="container footer_container">
            <article>
                <h4>Categories</h4>
                <ul>
                    <li><a href="category-posts2.html">Artificial Intelligence</a></li>
                    <li><a href="category-posts4.html">Stock Market</a></li>
                    <li><a href="category-posts5.html">Renewable Energy</a></li>
                    <li><a href="category-posts6.html">Electric Vehicles</a></li>
                    <li><a href="category-posts9.html">Recycling E-waste</a></li>
                    <li><a href="category-posts7.html">Sports</a></li>
                </ul>
            </article>
            <article>
                <h4>Support</h4>
                <ul>
                    <li><a href="contact.html">Call Numbers</a></li>
                    <li><a href="contact.html">Emails</a></li>
                </ul>
            </article>
            <article>
                <h4>Blog</h4>
                <ul>
                    <li><a href="popular.html">Popular</a></li>
                    <li><a href="category-posts.html?category=Artificial Intelligence">Categories</a></li>
                </ul>
            </article>
            <article>
                <h4>Permalinks</h4>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="blog.html">Blog</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="contact.html">Contacts</a></li>
                </ul>
            </article>
        </div>
        <div class="footer_copyright">
            <small>Copyright &copy; 2024 BlogMedia</small>
        </div>
    </footer>






<!-- <script src="./main.js"></script> -->
<script src="./nav.js"></script>

<script>

const postsContainer = document.querySelector(".posts_container");
const postsSection = document.querySelector(".posts");

let globalPosts = []; // To store fetched posts
let currentIndex = 0; // Track the current position in the posts array
const postsPerPage = 9; // Number of posts to display initially or on each click

addSkeletonArticles(3);

// Function to fetch posts
async function fetchPosts() {
  const postsSkeleton = document.getElementById("posts-skeleton");
  postsSection.style.display = "none";

  try {
    const response = await fetch("https://blog-website-beta-wine.vercel.app/get-publicPosts");
    if (!response.ok) throw new Error("Failed to fetch posts");

    const posts = await response.json();
    // console.log(posts);
    
    localStorage.setItem("posts", JSON.stringify(posts));

    postsSkeleton.style.display = "none";
    // Show real content sections
    postsSection.style.display = "block";

    initalPostsLoad();
    // console.log(posts);
    
    // displayPosts(posts);   ///////
  } catch (error) {
    console.error("Error fetching posts:", error);
    postsContainer.innerHTML = `<p>Failed to load posts. Please try again later.</p>`;
  }
}



// Handle search functionality
document.querySelector("#search-form")
.addEventListener("submit",function handleSearch(event) {
    event.preventDefault();
    // console.log('searchsearchsearch');
    
    const searchInput = document.querySelector("#search-input").value.toLowerCase().trim();
    // const posts = getPostsFromLocalStorage();

    // Filter posts by title or content
    const filteredPosts = globalPosts.filter((post) => {
        return (
        post.title.toLowerCase().includes(searchInput) ||
        post.content.toLowerCase().includes(searchInput)
        );
  });

  // Display filtered posts
  postsContainer.innerHTML = ``;  
  displayPosts(filteredPosts);
});


// Handle clear action or any input change
const searchInput = document.querySelector("#search-input");

searchInput.addEventListener("input", function handleInput() {
    const query = searchInput.value.toLowerCase().trim();

    // If input is cleared, show all posts
    if (!query) {
        // const posts = getPostsFromLocalStorage();
        // displayPosts(posts);
        loadMorePosts(true);
    }
});


const seeMoreButton = document.querySelector(".btn.sm");

// Function to load more posts
function loadMorePosts(isLoadTillCurrentIndex=false) {
    //ensure the argument is a boolean and not an event object
    if (typeof isLoadTillCurrentIndex !== "boolean") {
        isLoadTillCurrentIndex = false; // Handle unexpected event object
    }
    const remainingPosts = globalPosts.slice(currentIndex, currentIndex + postsPerPage);
    displayPosts(remainingPosts);
    if(!isLoadTillCurrentIndex) currentIndex += postsPerPage;
    // console.log('currentIndex',currentIndex,'isLoadTillCurrentIndex',isLoadTillCurrentIndex);

    // Hide "See More" button if all posts are loaded
    if (currentIndex >= globalPosts.length) {
        seeMoreButton.style.display = "none";
    }
}

// Event listener for "See More" button
seeMoreButton.addEventListener("click", loadMorePosts);

// Initial setup on DOMContentLoaded
function initalPostsLoad() {
    globalPosts = getPostsFromLocalStorage();
  if (globalPosts.length > 0) {
    loadMorePosts(); // Display the initial set of posts
  } else {
    postsContainer.innerHTML = `<p>No posts available.</p>`;
    seeMoreButton.style.display = "none"; // Hide button if no posts
  }
}


// Fetch posts from localStorage
function getPostsFromLocalStorage() {
  const posts = localStorage.getItem("posts");
  return posts ? JSON.parse(posts) : [];
}


// Function to display posts
function displayPosts(posts) {
//   postsContainer.innerHTML = ""; // Clear existing content

  posts.forEach((post) => {
    const postElement = document.createElement("article");
    postElement.classList.add("post");

    postElement.innerHTML = `
        <div class="post_thumbnail">
          <a href="post.html?id=${post.id}">
          <img src="${post.thumbnailURL || './images/blog27.jpg'}" alt="Post Thumbnail">
          </a>
        </div>
        <div id="post-meta">
            <div id="view-count"><i class="fa-solid fa-eye"></i><span id="views">${post.views}</span></div>
            <div id="like-count"><i class="fa-solid fa-thumbs-up"></i><span id="likes">${post.likes}</span></div>
            <div id="comment-count"><i class="fa-solid fa-comment-dots"></i><span id="comments">${post.commentsCount}</span></div>
        </div>
        <div class="post_info">
        <a href="category-posts.html?category=${encodeURIComponent(post.category)}" class="category_button">
          ${post.category}
        </a>
        <h3 class="post_title">
          <a href="post.html?id=${post.id}">${post.title}</a>
        </h3>
        <p class="post_body">
          ${post.content.substring(0, 300)}... <!-- Truncate content for preview -->
        </p>
        <div class="post_author">
          <div class="post_author-avatar">
            <img src="${post.authorAvatar || './images/default-avatar.jpg'}" alt="Author Avatar">
          </div>
          <div class="post_author-info">
            <h5>By: ${post.authorName || "Unknown Author"}</h5>
            <small>${formatDate(post.created_at)}</small>
          </div>
        </div>
      </div>
    `;

    postsContainer.appendChild(postElement);
  });
}


function formatDate(isoString) {
  const date = new Date(isoString);

  // Options for formatting the date
  const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
  const formattedDate = date.toLocaleDateString('en-US', dateOptions);

  // Options for formatting the time
  const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
  const formattedTime = date.toLocaleTimeString('en-US', timeOptions);

  return `${formattedDate} - ${formattedTime}`;
}



function addSkeletonArticles(count) {
  const postsSkeleton = document.querySelector("#posts-skeleton .posts_container");
  if (!postsSkeleton) {
    console.error("Skeleton container not found");
    return;
  }

  // Clear existing skeleton articles (optional)
  postsSkeleton.innerHTML = "";

  // Create and append the specified number of skeleton articles
  for (let i = 0; i < count; i++) {
    const skeletonArticle = `
      <article class="post">
        <div class="post_thumbnail skeleton-box"></div>
        <div id="post-meta">
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
          <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
        </div>
        <div class="post_info">
          <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
          <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
          <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
          <div class="post_author">
            <div class="post_author-avatar skeleton-box"></div>
            <div class="post_author-info">
              <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
              <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
            </div>
          </div>
        </div>
      </article>
    `;

    postsSkeleton.innerHTML += skeletonArticle;
  }
}


// Fetch posts on page load
fetchPosts();


</script>

</body>
</html>