<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog WebApp</title>
    <link rel="stylesheet" href="./style.css">
    <link rel="stylesheet" href="https://unicons.iconscout.com/release/v4.0.0/css/line.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
    <style>
        /* Header styling */

.category_title h2 {
    position: relative;    
    min-width: 20rem;
    text-align: center;
}
.category_title h2:hover {
    cursor: pointer;
}
.dropdown {
    width: 100%;
    position: absolute;
    top: 100%;
    left: 0;
    display: none;
    font-size: 0.85rem;
    font-weight: 400;
    background-color: #1c1c1c; /* Dark background */
    border: 1px solid #333;
    border-radius: 8px;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    max-height: 150px;
    overflow-y: auto;
    transition: opacity 0.3s ease-in-out, transform 0.2s ease-in-out;
    opacity: 0;
    transform: translateY(-5px);
}

.dropdown.show {
    display: block;
    opacity: 1;
    transform: translateY(0);
}

.dropdown-menu {
    list-style: none;
    padding: 8px 0;
    margin: 0;
}

.dropdown-menu li {
    padding: 10px 15px;
    cursor: pointer;
    color: #e0e0e0; /* Light text for contrast */
    /* background-color: #373737; */
    transition: background-color 0.2s ease-in-out;
}

.dropdown-menu li:hover {
    background-color: #292929; /* Slightly lighter hover effect */
    color: #ffffff;
    border-radius: 4px;
}

.category_title button{
    background-color: #cccccc00;
}

.dropdown-toggle .fa-chevron-down{
    color: #ff0000;
}



    </style>
</head>
<body>
    <nav>        
        <div class="container nav_container">
            <a href="index.html" class="nav_logo">BlogMedia</a>
            <ul class="nav_items">
                <li><a href="index.html">Home</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li class="active_navlink"><a href="category-posts.html?category=Artificial Intelligence">Categories</a></li>
                <li><a href="contact.html">Contact</a></li>
                <li><a href="signin.html">Sign In</a></li>
                <li class="nav_profile" style="display: none;">
                    <div class="avatar_container">
                        <div class="avatar">
                            <img src="./images/avatar1.jpg" alt="User Avatar">
                        </div>
                    </div>
                    <div class="username_cnt">
                        <span></span>
                    </div>
                    <ul class="nav_profile_popup">
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="logout.html">Log Out</a></li>
                    </ul>
                </li>
            </ul>
            <button id="open_nav-btn"><i class="uil uil-bars"></i></button>
            <button id="close_nav-btn"><i class="uil uil-multiply"></i></button>
        </div>
    </nav>





<!-- <header class="category_title">
    <h2>Artificial Intelligence</h2>
</header> -->
<header class="category_title " >
    <h2 class="dropdown-toggle"> <span id="categoryHeading">Artificial Intelligence </span>
        <button >
            <i class="fa-solid fa-chevron-down"></i>
        </button>
        <div class="dropdown">
            <ul class="dropdown-menu" id="categoryDropdown">
                <!-- <li><span>Category 1</span></li> -->
                <!-- <li><span>Category 1</span></li>
                <li><span>Category 1</span></li>
                <li><span>Category 1</span></li> -->
            </ul>
        </div>
    </h2>
    
</header>



<section class="posts">
    <div class="container posts_container">
        <!-- <article class="post">
            <div class="post_thumbnail">
                <img src="./images/blog2.jpg">
            </div>
            <div class="post_info">
                <a href="category-posts2.html" class="category_button">Artificial Intelligence</a>
                <h3 class="post_title"><a href="post2.html">AI Trends and Future Predictions</a></h3>
                <p class="post_body">
                    
                    Explore the dynamic world of AI in a blog covering its transformative trends. Discover how generative AI, including models like GPT-4 and DALL-E, is revolutionizing industries from advertising to entertainment. Dive into the impact of robotics and quantum computing on AI's capabilities and innovations.
                   </p>
                <div class="post_author">
                    <div class="post_author-avatar">
                        <img src="./images/avatar3.jpg">
                    </div>
                    <div class="post_author-info">
                        <h5>By: Vijay Sharma</h5>
                        <small>September 2, 2024 - 11:21</small>
                    </div>
                </div>
            </div>
        </article> -->
    </div>
    <div class="container flex-center">
        <button class="btn sm" style="font-size: 0.9rem;">See more</button>
    </div>     
</section>




<section class="posts skeleton" id="posts-skeleton">
    <div class="container posts_container">
        <!-- Repeat Skeleton Articles -->
        <article class="post">
            <div class="post_thumbnail skeleton-box"></div>
            <div id="post-meta">
                <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
                <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
            </div>
            <div class="post_info">
                <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
                <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
                <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
                <div class="post_author">
                    <div class="post_author-avatar skeleton-box"></div>
                    <div class="post_author-info">
                        <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
                        <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
                    </div>
                </div>
            </div>
        </article>
        <!-- Add more skeleton articles as needed -->
    </div>
</section>



<section class="category_buttons">
    <div class="container category_buttons-container">
        <a href="category-posts2.html" class="category_button">Artificial Intelligence</a>
        <a href="category-posts4.html" class="category_button">Stock Market</a>
        <a href="category-posts5.html" class="category_button">Renewable Energy</a>
        <a href="category-posts6.html" class="category_button">Electric Vehicles</a>
        <a href="category-posts9.html" class="category_button">Recycling E-waste</a>
        <a href="category-posts7.html" class="category_button">Sports</a>
    </div>
</section>





<footer>
    <div class="footer_socials">
        <a href="https://youtube.com"><li class="uil uil-youtube"></li></a>
        <a href="https://facebook.com"><li class="uil uil-facebook-f"></li></a>
        <a href="https://instagram.com"><li class="uil uil-instagram-alt"></li></a>
        <a href="https://linkedin.com"><li class="uil uil-linkedin"></li></a>
        <a href="https://tiwtter.com"><li class="uil uil-twitter"></li></a>
    </div>
    <div class="container footer_container">
        <article>
            <h4>Categories</h4>
            <ul>
                <li><a href="category-posts2.html">Artificial Intelligence</a></li>
                <li><a href="category-posts4.html">Stock Market</a></li>
                <li><a href="category-posts5.html">Renewable Energy</a></li>
                <li><a href="category-posts6.html">Electric Vehicles</a></li>
                <li><a href="category-posts9.html">Recycling E-waste</a></li>
                <li><a href="category-posts7.html">Sports</a></li>
            </ul>
        </article>
        <article>
            <h4>Support</h4>
            <ul>
                <li><a href="about.html">Call Numbers</a></li>
                <li><a href="about.html">Emails</a></li>
            </ul>
        </article>
        <article>
            <h4>Blog</h4>
            <ul>
                <li><a href="popular.html">Popular</a></li>
                <li><a href="index.html">Categories</a></li>
            </ul>
        </article>
        <article>
            <h4>Permalinks</h4>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="blog.html">Blog</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="contact.html">Contacts</a></li>
            </ul>
        </article>
    </div>
    <div class="footer_copyright">
        <small>Copyright &copy; 2024 BlogMedia</small>
    </div>
</footer>

<!-- <script src="./main.js"></script> -->

<!-- <script src="./main.js"></script> -->
<script src="./nav.js"></script>


<script>

document.addEventListener("DOMContentLoaded", () => {
    document.addEventListener("click", function (event) {        
        const dropdown = document.querySelector(".dropdown");
        if (event.target.closest(".dropdown-toggle")) {            
            dropdown.classList.add("show");
        } else {
            dropdown.classList.remove("show");
        }
    });

});

document.addEventListener("DOMContentLoaded", async () => {
    // Fetch categories from your backend API (assuming you have a `/get-categories` endpoint)
    try {
        const response = await fetch("https://blog-website-beta-wine.vercel.app/get-categories");
        const categories = await response.json();
        const categoryDropdown = document.getElementById("categoryDropdown");

        // Add categories to the dropdown
        categories.forEach((category) => {
            const listItem = document.createElement("li");
            listItem.textContent = category.title; // Assuming `title` is the name of the category
            listItem.setAttribute("title", category.title); // Store category ID for later use
            categoryDropdown.appendChild(listItem);
        });

        // Add event listeners to each category item
        const categoryItems = categoryDropdown.querySelectorAll("li");
        categoryItems.forEach((item) => {
            item.addEventListener("click", async (e) => {
                const selectedCategory = e.target.getAttribute("title");
                await fetchPostsByCategory(selectedCategory);
                document.getElementById('categoryHeading').innerText = selectedCategory;
            });
        });
    } catch (error) {
        console.error("Error fetching categories:", error);
    }
});

// Fetch posts by category ID
async function fetchPostsByCategory(category_title) {
    try {
        const response = await fetch(`https://blog-website-beta-wine.vercel.app/get-posts/${category_title}`);
        const posts = await response.json();
        postsContainer.innerHTML = ``;
        displayPosts(posts);
    } catch (error) {
        console.error("Error fetching posts by category:", error);
    }
}


    const postsContainer = document.querySelector(".posts_container");
    const postsSection = document.querySelector(".posts");    
    let globalPosts = []; // To store fetched posts
    let currentIndex = 0; // Track the current position in the posts array
    const postsPerPage = 9; // Number of posts to display initially or on each click
    
    addSkeletonArticles(3);
    const urlParams = new URLSearchParams(window.location.search);
    const postCategory = urlParams.get('category');
    document.getElementById('categoryHeading').innerText = postCategory;

    // Function to fetch posts
    async function fetchPosts() {
      const postsSkeleton = document.getElementById("posts-skeleton");
      postsSection.style.display = "none";
    
      try {
        const response = await fetch(`https://blog-website-beta-wine.vercel.app/get-posts/${postCategory}`);
        if (!response.ok) throw new Error("Failed to fetch posts");
    
        const posts = await response.json();
        // console.log(posts);        
        localStorage.setItem("posts", JSON.stringify(posts));
    
        postsSkeleton.style.display = "none";
        // Show real content sections
        postsSection.style.display = "block";
    
        initalPostsLoad();
        // console.log(posts);        
        // displayPosts(posts);   ///////
      } catch (error) {
        console.error("Error fetching posts:", error);
        postsContainer.innerHTML = `<p>Failed to load posts. Please try again later.</p>`;
      }
    }
    
    
    const seeMoreButton = document.querySelector(".btn.sm");   
    seeMoreButton.addEventListener("click", loadMorePosts);
    // Function to load more posts
    function loadMorePosts(isLoadTillCurrentIndex=false) {
        //ensure the argument is a boolean and not an event object
        if (typeof isLoadTillCurrentIndex !== "boolean") {
            isLoadTillCurrentIndex = false; // Handle unexpected event object
        }
        const remainingPosts = globalPosts.slice(currentIndex, currentIndex + postsPerPage);
        // console.log('remainingPosts',remainingPosts);
        
        displayPosts(remainingPosts);
        if(!isLoadTillCurrentIndex) currentIndex += postsPerPage;    
        // Hide "See More" button if all posts are loaded
        if (currentIndex >= globalPosts.length) {
            seeMoreButton.style.display = "none";
        }
    }

    
    // Initial setup on DOMContentLoaded
    function initalPostsLoad() {
        globalPosts = getPostsFromLocalStorage();
      if (globalPosts.length > 0) {
        loadMorePosts(); // Display the initial set of posts
      } else {
        postsContainer.innerHTML = `<p>No posts available.</p>`;
        seeMoreButton.style.display = "none"; // Hide button if no posts
      }
    }
    
    
    // Fetch posts from localStorage
    function getPostsFromLocalStorage() {
      const posts = localStorage.getItem("posts");
      return posts ? JSON.parse(posts) : [];
    }
    
    
    // Function to display posts
    function displayPosts(posts) {
    //   postsContainer.innerHTML = ""; // Clear existing content
    
      posts.forEach((post) => {
        const postElement = document.createElement("article");
        postElement.classList.add("post");
    
        postElement.innerHTML = `
            <div class="post_thumbnail">
                <a href="post.html?id=${post.id}">
              <img src="${post.thumbnailURL || './images/blog27.jpg'}" alt="Post Thumbnail">
              </a>
            </div>
            <div id="post-meta">
                <div id="view-count"><i class="fa-solid fa-eye"></i><span id="views">${post.views}</span></div>
                <div id="like-count"><i class="fa-solid fa-thumbs-up"></i><span id="likes">${post.likes}</span></div>
                <div id="comment-count"><i class="fa-solid fa-comment-dots"></i><span id="comments">${post.commentsCount}</span></div>
            </div>
            <div class="post_info">
            <a href="category-posts.html?category=${encodeURIComponent(post.category)}" class="category_button">
              ${post.category}
            </a>
            <h3 class="post_title">
              <a href="post.html?id=${post.id}">${post.title}</a>
            </h3>
            <p class="post_body">
              ${post.content.substring(0, 300)}... <!-- Truncate content for preview -->
            </p>
            <div class="post_author">
              <div class="post_author-avatar">
                <img src="${post.authorAvatar || './images/default-avatar.jpg'}" alt="Author Avatar">
              </div>
              <div class="post_author-info">
                <h5>By: ${post.authorName || "Unknown Author"}</h5>
                <small>${formatDate(post.created_at)}</small>
              </div>
            </div>
          </div>
        `;
    
        postsContainer.appendChild(postElement);
      });
    }
    
    
    function formatDate(isoString) {
      const date = new Date(isoString);
    
      // Options for formatting the date
      const dateOptions = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = date.toLocaleDateString('en-US', dateOptions);
    
      // Options for formatting the time
      const timeOptions = { hour: '2-digit', minute: '2-digit', hour12: false };
      const formattedTime = date.toLocaleTimeString('en-US', timeOptions);
    
      return `${formattedDate} - ${formattedTime}`;
    }
    
    
    
    function addSkeletonArticles(count) {
      const postsSkeleton = document.querySelector("#posts-skeleton .posts_container");
      if (!postsSkeleton) {
        console.error("Skeleton container not found");
        return;
      }
    
      // Clear existing skeleton articles (optional)
      postsSkeleton.innerHTML = "";
    
      // Create and append the specified number of skeleton articles
      for (let i = 0; i < count; i++) {
        const skeletonArticle = `
          <article class="post">
            <div class="post_thumbnail skeleton-box"></div>
            <div id="post-meta">
              <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
              <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
              <div class="skeleton-box" style="width: 80px; height: 20px;"></div>
            </div>
            <div class="post_info">
              <div class="skeleton-box" style="width: 60%; height: 20px;"></div>
              <h3 class="skeleton-box" style="height: 30px; width: 70%;"></h3>
              <p class="skeleton-box" style="height: 60px; width: 90%;"></p>
              <div class="post_author">
                <div class="post_author-avatar skeleton-box"></div>
                <div class="post_author-info">
                  <div class="skeleton-box" style="height: 20px; width: 100%;"></div>
                  <div class="skeleton-box" style="height: 15px; width: 90%;"></div>
                </div>
              </div>
            </div>
          </article>
        `;
    
        postsSkeleton.innerHTML += skeletonArticle;
      }
    }
    
    
    // Fetch posts on page load
    fetchPosts();
    
    
    </script>

</body>
</html>